<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calibrating a molecular phylogeny of the sharks • rOpenSci: nbaR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- ropensci --><link href="../ropensci.css" rel="stylesheet">
<meta property="og:title" content="Calibrating a molecular phylogeny of the sharks">
<meta property="og:description" content="nbaR">
<meta name="twitter:card" content="summary">
<!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a href="https://ropensci.org"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
        <a class="navbar-brand" href="../index.html"><i>nbaR <small>v0.1.0</small></i></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/nbaR.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Documentation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/apiclient.html">Objects and advanced queries</a>
    </li>
    <li>
      <a href="../articles/services.html">Services summary</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Example Workflows
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/sharks.html">Calibrating a molecular phylogeny of the sharks</a>
    </li>
    <li>
      <a href="../articles/tomato.html">The oldest tomato specimen in the world</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/apiclient.html">nbaR API client: concepts and object model</a>
    </li>
    <li>
      <a href="../articles/services.html">nbaR services examples</a>
    </li>
    <li>
      <a href="../articles/sharks.html">Calibrating a molecular phylogeny of the sharks</a>
    </li>
    <li>
      <a href="../articles/tomato.html">The oldest tomato specimen in the world</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/naturalis/nbaR">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right docsearch" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Calibrating a molecular phylogeny of the sharks</h1>
            
            <h4 class="date">Mar 13, 2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/nbaR/blob/master/vignettes/sharks.Rmd"><code>vignettes/sharks.Rmd</code></a></small>
      <div class="hidden name"><code>sharks.Rmd</code></div>

    </div>

    
    
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>The time-calibration of molecular phylogenies is essential to many phylogenetic comparative analyses. Time-calibration can be accomplished with e.g. data from fossil specimen that can be assigned to a certain taxonomic group. Specimen ages can be determined by e.g. carbon dating or stratigraphic methods. Node ages are usually assigned using Bayesian or maximum-likelihood methods.</p>
<p>Some of the specimen records at Naturalis hold stratigraphic information. Here we will demonstrate how to extract this data using <code>nbaR</code> and how to create input for the popular tree-calibration function <code>chronos</code> from the phylogenetic analysis package <code>ape</code>.</p>
<div id="the-phylogeny" class="section level2">
<h2 class="hasAnchor">
<a href="#the-phylogeny" class="anchor"></a>The phylogeny</h2>
<p>As input, we will use a species-level molecular shark phylogeny published by <span class="citation">(Vélez-Zuazo and Agnarsson 2011)</span>.</p>
<p>The phylogeny is a majority-rule consensus tree inferred from molecular markers using Bayesian inference and comprises 229 species in all eight orders of the sharks (superorder <em>Selachimorpha</em>):</p>
<p><img src="https://ars.els-cdn.com/content/image/1-s2.0-S1055790310004537-gr3.jpg"></p>
<p>The non-ultrametric tree in the above figure is not time-calibrated, the branch lengths thus represent molecular distances.</p>
</div>
</div>
<div id="getting-chronological-data-with-nbar" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-chronological-data-with-nbar" class="anchor"></a>Getting chronological data with nbaR</h1>
<p>Chronological association is associated with <code>Specimen</code> data, we thus instantiate a <code>SpecimenClient</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/nbaR">nbaR</a></span><span class="op">)</span>
<span class="va">sc</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/SpecimenClient.html">SpecimenClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>In total, there are <a href="https://en.wikipedia.org/wiki/Shark">eight extant shark orders</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shark_orders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">"Carcharhiniformes"</span>,
  <span class="st">"Heterodontiformes"</span>,
  <span class="st">"Hexanchiformes"</span>,
  <span class="st">"Lamniformes"</span>,
  <span class="st">"Orectolobiformes"</span>,
  <span class="st">"Pristiophoriformes"</span>,
  <span class="st">"Squaliformes"</span>,
  <span class="st">"Squatiniformes"</span>
<span class="op">)</span></code></pre></div>
<p>We can then formulate a query condition for specimens that are identified in one of these orders using the operator <code>IN</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">qc</span> <span class="op">&lt;-</span>
  <span class="va"><a href="../reference/QueryCondition.html">QueryCondition</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>field <span class="op">=</span> <span class="st">"identifications.defaultClassification.order"</span>,
                     operator <span class="op">=</span> <span class="st">"IN"</span>,
                     value <span class="op">=</span> <span class="va">shark_orders</span><span class="op">)</span></code></pre></div>
<p>For many specimens, chronological information is available in the fields <code>gatheringEvent.chronoStratigraphy.youngChronoName</code> and <code>gatheringEvent.chronoStratigraphy.oldChronoName</code> which represent upper- and lower time bounds, respectively. Below, we will formulate a <code>QueryCondition</code> that requires either one of these fields to be non-empty:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## formulate query conditions for fields to be non-empty</span>
<span class="va">qc2</span> <span class="op">&lt;-</span>
  <span class="va"><a href="../reference/QueryCondition.html">QueryCondition</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>field <span class="op">=</span>
                       <span class="st">"gatheringEvent.chronoStratigraphy.youngChronoName"</span>,
                     operator <span class="op">=</span> <span class="st">"NOT_EQUALS"</span>,
                     value <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="va">qc3</span> <span class="op">&lt;-</span>
  <span class="va"><a href="../reference/QueryCondition.html">QueryCondition</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>field <span class="op">=</span>
                       <span class="st">"gatheringEvent.chronoStratigraphy.oldChronoName"</span>,
                     operator <span class="op">=</span> <span class="st">"NOT_EQUALS"</span>,
                     value <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="co">## join qc2 and qc3 with operator OR</span>
<span class="va">qc2</span><span class="op">$</span><span class="va">or</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">qc3</span><span class="op">)</span></code></pre></div>
<p>Now we can do the query:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## instantiate QuerySpec, give size</span>
<span class="va">qs</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/QuerySpec.html">QuerySpec</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">qc</span>, <span class="va">qc3</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="va">sc</span><span class="op">$</span><span class="fu">query</span><span class="op">(</span>querySpec <span class="op">=</span> <span class="va">qs</span><span class="op">)</span>

<span class="co">## how many hits?</span>
<span class="va">res</span><span class="op">$</span><span class="va">content</span><span class="op">$</span><span class="va">totalSize</span></code></pre></div>
<pre><code>## [1] 4009</code></pre>
<p><strong>Note</strong>: By default, a query returns only data for the first 10 hits. Above, we set the <code>size</code> parameter to the QuerySpec constructor to allow the download of up to 5000 values This number was based on the prior knowloedge that there are less than 5000 records for our query; We advise to always check the length of the resultSet against the <code>totalSize</code> of a <code>QueryResult</code> to make sure that all records are downloaded, e.g.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">content</span><span class="op">$</span><span class="va">resultSet</span><span class="op">)</span> <span class="op">==</span> <span class="va">res</span><span class="op">$</span><span class="va">content</span><span class="op">$</span><span class="va">totalSize</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div id="exploring-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#exploring-the-data" class="anchor"></a>Exploring the data</h2>
<p>Now we can explore the data:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## load all specimens</span>
<span class="va">specimens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">content</span><span class="op">$</span><span class="va">resultSet</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="va">x</span><span class="op">$</span><span class="va">item</span><span class="op">)</span>

<span class="co">## check the fields youngCronoName and oldChronoName</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">specimens</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
    <span class="va">x</span><span class="op">$</span><span class="va">gatheringEvent</span><span class="op">$</span><span class="va">chronoStratigraphy</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">youngChronoName</span><span class="op">)</span>
<span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "Upper Miocene"  "Miocene"        "Lower Miocene"  "Pliocene"      
##  [5] "Pleistocene"    "Chattian"       "Oligocene"      "Pliocene?"     
##  [9] "Cretaceous"     "Paleocene"      "Maastrichtian"  "Middle Miocene"</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">specimens</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
    <span class="va">x</span><span class="op">$</span><span class="va">gatheringEvent</span><span class="op">$</span><span class="va">chronoStratigraphy</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">oldChronoName</span><span class="op">)</span>
<span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "Upper Miocene"                                    
##  [2] "Miocene"                                          
##  [3] "Lower Miocene"                                    
##  [4] "Oligoceen, Rupelien"                              
##  [5] "Mioceen"                                          
##  [6] "Middle Miocene"                                   
##  [7] "M.mioceen"                                        
##  [8] "Recent"                                           
##  [9] "Unindentified Age"                                
## [10] "Pliocene"                                         
## [11] "Oligocene"                                        
## [12] "Unspecified age"                                  
## [13] "Rupelian"                                         
## [14] "Middle Eocene"                                    
## [15] "Ypresian"                                         
## [16] "Priabonian"                                       
## [17] "Pleistocene"                                      
## [18] "Neogene"                                          
## [19] "Eocene"                                           
## [20] "Cretaceous"                                       
## [21] "Kwartaire afzetting op zanden van Grimmertingen"  
## [22] "Lower Rupelian"                                   
## [23] "A. karsteni - Niso sp. Ass. Zone"                 
## [24] "Middle Miocen"                                    
## [25] "? Kwartaire afzetting op zanden van Grimmertingen"
## [26] "Middle Pliocene"                                  
## [27] "Paleocene"                                        
## [28] "Cenomanian"                                       
## [29] "Maastrichtian"                                    
## [30] "Mioceen?"                                         
## [31] "Early Miocene"                                    
## [32] "Recent?"                                          
## [33] "Plio-Pleistocene?"                                
## [34] "Unspecified Age"                                  
## [35] "Plio-Pleistoceen"                                 
## [36] "Unindentified A"                                  
## [37] "Lower Miocene?"                                   
## [38] "Onder-Plioceen"                                   
## [39] "B.Mioceen"                                        
## [40] "Oligoceen"                                        
## [41] "M.Miocen"                                         
## [42] "Onderste Rupelien"                                
## [43] "Pliocene?"                                        
## [44] "Tertiair"                                         
## [45] "Upper Eocene"</code></pre>
<p><strong>Caution</strong>: As you see above, there can be more than one chronoStratigraphy assigned with a specimen. Check how many we have per specimen:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">content</span><span class="op">$</span><span class="va">resultSet</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">item</span><span class="op">$</span><span class="va">gatheringEvent</span><span class="op">$</span><span class="va">chronoStratigraphy</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Each <code>gatheringEvent</code> in each <code>Specimen</code> has only one <code>chronoStratigraphy</code>. We thus do not miss data by taking the first one (<code>chronoStratigraphy[[1]]</code>).</p>
<p>Do we have hits for all orders? Below, we make an overview of the field <code>identifications.defaultClassification.order</code> for all specimen.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## make table with counts for each order</span>
<span class="va">tab</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">specimens</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
      <span class="va">x</span><span class="op">$</span><span class="va">identifications</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">defaultClassification</span><span class="op">$</span><span class="va">order</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5.1</span>, <span class="fl">8</span>, <span class="fl">4.1</span>, <span class="fl">2.1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">tab</span><span class="op">)</span>,
        horiz <span class="op">=</span> <span class="cn">TRUE</span>,
        las <span class="op">=</span> <span class="fl">2</span>,
        xlab <span class="op">=</span> <span class="st">"Number of specimens"</span><span class="op">)</span></code></pre></div>
<p><img src="sharks_files/figure-html/plot_orders-1.png" width="700"></p>
<p><strong>Caution</strong>: There can be multiple identifications for one specimen. Some specimens in our data are for instance assigned to different genera. However, the field <code>preferred</code> in an <code>Identification</code> object states if this is the most accurate and recent identification. The preferred identification is usually the first in the list of a specimen’s identifications. It can, however, occur that there are multiple identifications of which none is preferred; it is best to filter them out:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## get the specimens which have a preferred identification</span>
<span class="va">ident</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">specimens</span>, <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">identifications</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
      <span class="va">i</span><span class="op">$</span><span class="va">preferred</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">## how many do not have a preferred identification?</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">ident</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## filter specimens</span>
<span class="va">specimens</span> <span class="op">&lt;-</span> <span class="va">specimens</span><span class="op">[</span><span class="va">ident</span><span class="op">]</span></code></pre></div>
<p>Let’s further explore the data. To see what part of the animals were preserved, we can look into the field <code>kindOfUnit</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">specimens</span>, <span class="va">`[[`</span>, <span class="st">"kindOfUnit"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## AnimalPart      tooth   vertebra 
##          2       4003          1</code></pre>
<p>Almost all of them are teeth.</p>
</div>
<div id="getting-absolute-ages" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-absolute-ages" class="anchor"></a>Getting absolute ages</h2>
<p>The type of chronostratigraphic data (as shown above) is given in divisions on the geological time scale, e.g. <em>Miocene</em>. These strings can refer to <em>eons</em>, <em>eras</em>, <em>periods</em>, <em>epochs</em> and <em>ages</em>. In order to translate this into absolute ages, we will use the API of the <a href="http://earthlifeconsortium.org/">Earth Life Consortium</a>. This is possible using the <em>convenience function</em> <code>geo_age</code>. For example</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## get the upper chrono name for the first specimen</span>
<span class="va">name</span> <span class="op">&lt;-</span> <span class="va">specimens</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">gatheringEvent</span><span class="op">$</span><span class="va">chronoStratigraphy</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">oldChronoName</span>
<span class="va">name</span></code></pre></div>
<pre><code>## [1] "Upper Miocene"</code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## get the lower and upper bounds for this division</span>
<span class="fu"><a href="../reference/geo_age.html">geo_age</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span></code></pre></div>
<pre><code>##           Upper Miocene
## early_age         11.61
## late_age           5.33</code></pre>
<p>We can now make a table with all interesting data, below this is done for the first 50 specimen objects:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Get genus, species and chrono information from specimen records</span>
<span class="va">data</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">specimens</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">genus</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">identifications</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">defaultClassification</span><span class="op">$</span><span class="va">genus</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span>
      <span class="va">genus</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
    <span class="va">specificEpithet</span> <span class="op">&lt;-</span>
      <span class="va">x</span><span class="op">$</span><span class="va">identifications</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">defaultClassification</span><span class="op">$</span><span class="va">specificEpithet</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">specificEpithet</span><span class="op">)</span><span class="op">)</span>
      <span class="va">specificEpithet</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
    <span class="va">youngChronoName</span> <span class="op">&lt;-</span>
      <span class="va">x</span><span class="op">$</span><span class="va">gatheringEvent</span><span class="op">$</span><span class="va">chronoStratigraphy</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">youngChronoName</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">youngChronoName</span><span class="op">)</span><span class="op">)</span>
      <span class="va">youngChronoName</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
    <span class="va">oldChronoName</span> <span class="op">&lt;-</span>
      <span class="va">x</span><span class="op">$</span><span class="va">gatheringEvent</span><span class="op">$</span><span class="va">chronoStratigraphy</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">oldChronoName</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">oldChronoName</span><span class="op">)</span><span class="op">)</span>
      <span class="va">oldChronoName</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
      genus <span class="op">=</span> <span class="va">genus</span>,
      specificEpithet <span class="op">=</span> <span class="va">specificEpithet</span>,
      youngChronoName <span class="op">=</span> <span class="va">youngChronoName</span>,
      oldChronoName <span class="op">=</span> <span class="va">oldChronoName</span>
    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Get absolute ages from earth life consortium</span>
<span class="va">times</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/geo_age.html">geo_age</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">youngChronoName</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">oldChronoName</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retrieve time values for geo unit
## "Oligoceen, Rupelien" from earthlifeconsortium.org, returning NA</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retrieve time values for geo unit
## "Mioceen" from earthlifeconsortium.org, returning NA</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retrieve time values for geo unit
## "M.mioceen" from earthlifeconsortium.org, returning NA</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retrieve time values for geo unit
## "Recent" from earthlifeconsortium.org, returning NA</code></pre>
<pre><code>## Warning in FUN(X[[i]], ...): Could not retrieve time values for geo unit
## "Unindentified Age" from earthlifeconsortium.org, returning NA</code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## add upper and lower bounds to ages</span>
<span class="va">data</span><span class="op">$</span><span class="va">young_age</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">youngChronoName</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">times</span><span class="op">[</span><span class="st">"late_age"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">data</span><span class="op">$</span><span class="va">old_age</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">oldChronoName</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">times</span><span class="op">[</span><span class="st">"early_age"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">data</span></code></pre></div>
<pre><code>##             genus specificEpithet youngChronoName       oldChronoName young_age
## 1      Odontaspis           vorax   Upper Miocene       Upper Miocene      5.33
## 2  Cosmopolitodus        hastalis         Miocene                &lt;NA&gt;      5.33
## 3  Cosmopolitodus        hastalis         Miocene             Miocene      5.33
## 4  Cosmopolitodus        hastalis         Miocene             Miocene      5.33
## 5   Carcharhinus?      sp. indet.            &lt;NA&gt;       Lower Miocene        NA
## 6   Carcharhinus?      sp. indet.            &lt;NA&gt;       Lower Miocene        NA
## 7        Squatina         biforis            &lt;NA&gt;       Lower Miocene        NA
## 8    Carcharhinus       elongatus            &lt;NA&gt; Oligoceen, Rupelien        NA
## 9          Isurus        benedeni            &lt;NA&gt;                &lt;NA&gt;        NA
## 10         Isurus        benedeni   Lower Miocene       Lower Miocene     15.97
## 11 Cosmopolitodus        hastalis   Upper Miocene       Upper Miocene      5.33
## 12 Cosmopolitodus        hastalis   Upper Miocene       Upper Miocene      5.33
## 13          Lamna             sp.        Pliocene             Miocene      2.59
## 14         Isurus        hastalis            &lt;NA&gt;       Upper Miocene        NA
## 15 Cosmopolitodus        hastalis            &lt;NA&gt;       Upper Miocene        NA
## 16         Isurus         escheri            &lt;NA&gt;       Upper Miocene        NA
## 17 Cosmopolitodus        hastalis        Pliocene                &lt;NA&gt;      2.59
## 18     Cetorhinus             sp.        Pliocene                &lt;NA&gt;      2.59
## 19        Squalus       acanthias        Pliocene                &lt;NA&gt;      2.59
## 20         Indet.            &lt;NA&gt;        Pliocene             Miocene      2.59
## 21   Notorhynchus     primigenius            &lt;NA&gt;             Mioceen        NA
## 22     Carcharias     acutissimus            &lt;NA&gt;             Mioceen        NA
## 23         Isurus        hastalis            &lt;NA&gt;      Middle Miocene        NA
## 24         Isurus        hastalis            &lt;NA&gt;      Middle Miocene        NA
## 25         Isurus        hastalis            &lt;NA&gt;      Middle Miocene        NA
## 26      Notidanus     primigenius            &lt;NA&gt;      Middle Miocene        NA
## 27     Galeocerdo         aduncus            &lt;NA&gt;      Middle Miocene        NA
## 28     Galeocerdo         aduncus            &lt;NA&gt;      Middle Miocene        NA
## 29      Notidanus     primigenius            &lt;NA&gt;      Middle Miocene        NA
## 30      Notidanus             sp.            &lt;NA&gt;             Mioceen        NA
## 31      Hypoprion      acanthodon            &lt;NA&gt;      Middle Miocene        NA
## 32       Squatina      sp. indet.            &lt;NA&gt;      Middle Miocene        NA
## 33     Odontaspis      acutissima            &lt;NA&gt;           M.mioceen        NA
## 34         Isurus        hastalis            &lt;NA&gt;       Upper Miocene        NA
## 35 Cosmopolitodus         escheri            &lt;NA&gt;             Miocene        NA
## 36     Cetorhinus         maximus            &lt;NA&gt;             Miocene        NA
## 37     Carcharias             sp.            &lt;NA&gt;             Miocene        NA
## 38       Squatina        squatina            &lt;NA&gt;              Recent        NA
## 39   Scyliorhinus       stellaris            &lt;NA&gt;              Recent        NA
## 40  Centroscymnus      coelolepis            &lt;NA&gt;              Recent        NA
## 41   Carcharhinus       elongatus     Pleistocene             Miocene      0.01
## 42    Galeorhinus      recticonus            &lt;NA&gt;             Mioceen        NA
## 43     Odontaspis      acutissima            &lt;NA&gt;       Upper Miocene        NA
## 44         Isurus        hastalis            &lt;NA&gt;   Unindentified Age        NA
## 45      Notidanus      sp. indet.            &lt;NA&gt;   Unindentified Age        NA
## 46      Notidanus      sp. indet.            &lt;NA&gt;            Pliocene        NA
## 47 Cosmopolitodus        hastalis        Pliocene                &lt;NA&gt;      2.59
## 48        Squalus       alsaticus            &lt;NA&gt;           Oligocene        NA
## 49        Squalus       alsaticus            &lt;NA&gt;           Oligocene        NA
## 50        Squalus       alsaticus            &lt;NA&gt;           Oligocene        NA
##    old_age
## 1    11.61
## 2       NA
## 3    23.03
## 4    23.03
## 5    23.03
## 6    23.03
## 7    23.03
## 8       NA
## 9       NA
## 10   23.03
## 11   11.61
## 12   11.61
## 13   23.03
## 14   11.61
## 15   11.61
## 16   11.61
## 17      NA
## 18      NA
## 19      NA
## 20   23.03
## 21      NA
## 22      NA
## 23   15.97
## 24   15.97
## 25   15.97
## 26   15.97
## 27   15.97
## 28   15.97
## 29   15.97
## 30      NA
## 31   15.97
## 32   15.97
## 33      NA
## 34   11.61
## 35   23.03
## 36   23.03
## 37   23.03
## 38      NA
## 39      NA
## 40      NA
## 41   23.03
## 42      NA
## 43   11.61
## 44      NA
## 45      NA
## 46    5.33
## 47      NA
## 48   33.90
## 49   33.90
## 50   33.90</code></pre>
</div>
</div>
<div id="calibrating-the-phylogeny" class="section level1">
<h1 class="hasAnchor">
<a href="#calibrating-the-phylogeny" class="anchor"></a>Calibrating the phylogeny</h1>
<p>Depending on the data, calibration points could be chosen on different taxonomic levels. If there are sufficient specimens determined at species level, one could use the upper- and lower bounds above. It is also possible to average upper- and lower values for a higher taxonomic group, such as genus or family. Since this requires some data cleaning, such as dealing with duplicates, missing data, etc, <code>nbaR</code> offers the function <code>chronos_calib</code> which takes a set of specimen object, and a tree and averages the data for a user-defined taxonomic group and returns a calibration table that can be directly used as input for the function <code>chronos</code> from the package <code>ape</code>. The function also determines the node which will be calibrated in the phylogenetic tree.</p>
<p>The shark phylogeny comes with the package and can be parsed using the package <code>ape</code>:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/">ape</a></span><span class="op">)</span>

<span class="co">## read data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">shark_tree</span><span class="op">)</span>

<span class="co">## plot the tree</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">shark_tree</span>, cex <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></code></pre></div>
<p><img src="sharks_files/figure-html/read_tree-1.png" width="700"></p>
<div id="genus-level" class="section level2">
<h2 class="hasAnchor">
<a href="#genus-level" class="anchor"></a>Genus level</h2>
<p>Now we use <code>chronos_calib</code> to get the table at the genus level. <code>chronos_calib</code> also selects the nodes in the tree that will be calibrated. This is done by selecting the most recent common ancestor (mrca) of the species for which the data are averaged.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## make calibration table on genus level</span>
<span class="va">calibration_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chronos_calib.html">chronos_calib</a></span><span class="op">(</span><span class="va">specimens</span>, <span class="va">shark_tree</span>, <span class="st">"genus"</span><span class="op">)</span></code></pre></div>
<p><strong>Note</strong>: This function can produce many warnings, a warning is emitted whenever, for some geological division, no data can be obtained from the earth life consortium. This can be due to misspellings or words in foreign languages.</p>
<p>The calibration table looks as follows:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">calibration_table</span></code></pre></div>
<pre><code>##    node   age.min  age.max soft.bounds         taxon
## 1   432  2.635714 21.35846       FALSE  Carcharhinus
## 2   364  0.870000 25.12714       FALSE        Galeus
## 3   311 66.000000 83.20000       FALSE  Heterodontus
## 4   243  5.444545 21.84214       FALSE     Hexanchus
## 5   320  4.745833 16.46489       FALSE        Isurus
## 6   318 28.984615 49.32840       FALSE         Lamna
## 7   245  3.503333 26.13571       FALSE Pristiophorus
## 8   346  3.960000 30.67263       FALSE  Scyliorhinus
## 9   428  0.010000 20.20600       FALSE       Sphyrna
## 10  297  5.708182 30.13364       FALSE       Squalus
## 11  237 16.384000 30.11038       FALSE      Squatina</code></pre>
<p><strong>Note</strong>: It is essential to thoroughly evaluate the calibration table! In this example, for example, the genus <em>Squatina</em> is non-monophyletic and one species is placed somewhere else in the tree. Calibrating the most recent common ancestor node for this genus can therefore result in errors using the calibration routine. We will therefore remove the calibration points for genus <em>Squatina</em> before calibration:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## clean up: one rogue taxon in genus "Squatina"! Skip this genus</span>
<span class="va">calibration_table</span> <span class="op">&lt;-</span>
  <span class="va">calibration_table</span><span class="op">[</span><span class="va">calibration_table</span><span class="op">$</span><span class="va">taxon</span> <span class="op">!=</span> <span class="st">"Squatina"</span>,<span class="op">]</span>

<span class="co">## run ape's chronos</span>
<span class="va">chronogram</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/chronos.html">chronos</a></span><span class="op">(</span><span class="va">shark_tree</span>, calibration <span class="op">=</span> <span class="va">calibration_table</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Setting initial dates...
## Fitting in progress... get a first set of estimates
##          (Penalised) log-lik = -57.87138 
## Optimising rates... dates... -57.87138 
## Optimising rates... dates... -57.8675 
## Optimising rates... dates... -57.86235 
## Optimising rates... dates... -57.86031 
## Optimising rates... dates... -57.85691 
## Optimising rates... dates... -57.8554 
## Optimising rates... dates... -57.85281 
## Optimising rates... dates... -57.85052 
## Optimising rates... dates... -57.84921 
## Optimising rates... dates... -57.84734 
## Optimising rates... dates... -57.84571 
## Optimising rates... dates... -57.84425 
## Optimising rates... dates... -57.84289 
## Optimising rates... dates... -57.84166 
## Optimising rates... dates... -57.84055 
## Optimising rates... dates... -57.83961 
## Optimising rates... dates... -57.83867 
## Optimising rates... dates... -57.83778 
## Optimising rates... dates... -57.83696 
## Optimising rates... dates... -57.8362</code></pre>
<pre><code>## Warning: Maximum number of dual iterations reached.</code></pre>
<pre><code>## 
## log-Lik = -57.81222 
## PHIIC = 1503.63</code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## plot tree with time axis</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">chronogram</span>, cex <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ape/man/axisPhylo.html">axisPhylo</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">## plot calibrated genera</span>
<span class="fu"><a href="https://rdrr.io/pkg/ape/man/nodelabels.html">nodelabels</a></span><span class="op">(</span><span class="va">calibration_table</span><span class="op">$</span><span class="va">taxon</span>, <span class="va">calibration_table</span><span class="op">$</span><span class="va">node</span><span class="op">)</span></code></pre></div>
<p><img src="sharks_files/figure-html/plot_calib-1.png" width="700"></p>
</div>
<div id="family-level" class="section level2">
<h2 class="hasAnchor">
<a href="#family-level" class="anchor"></a>Family level</h2>
<p>We can also calibrate the tree on the family level:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## make calibration table on family level</span>
<span class="va">calibration_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chronos_calib.html">chronos_calib</a></span><span class="op">(</span><span class="va">specimens</span>, <span class="va">shark_tree</span>, <span class="st">"family"</span><span class="op">)</span>

<span class="co">## run ape's chronos</span>
<span class="va">chronogram</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/chronos.html">chronos</a></span><span class="op">(</span><span class="va">shark_tree</span>, calibration <span class="op">=</span> <span class="va">calibration_table</span><span class="op">)</span>

<span class="co">## plot tree with time axis</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">chronogram</span>, cex <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ape/man/axisPhylo.html">axisPhylo</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">## plot calibrated families</span>
<span class="fu"><a href="https://rdrr.io/pkg/ape/man/nodelabels.html">nodelabels</a></span><span class="op">(</span><span class="va">calibration_table</span><span class="op">$</span><span class="va">taxon</span>, <span class="va">calibration_table</span><span class="op">$</span><span class="va">node</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-VELEZZUAZO2011207">
<p>Vélez-Zuazo, Ximena, and Ingi Agnarsson. 2011. “Shark Tales: A Molecular Species-Level Phylogeny of Sharks (Selachimorpha, Chondrichthyes).” <em>Molecular Phylogenetics and Evolution</em> 58 (2): 207–17. <a href="https://doi.org/https://doi.org/10.1016/j.ympev.2010.11.018">https://doi.org/https://doi.org/10.1016/j.ympev.2010.11.018</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="http://github.com/ropensci" target="_blank"><div class="icon fab fa-github"></div></a>
                        <a href="http://github.com/ropenscilabs" target="_blank"><div class="icon fa fa-flask"></div></a>
                        <a href="http://twitter.com/ropensci" target="_blank"><div class="icon fab fa-twitter"></div></a>
                        <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review">Software Review Process</a></li>
                            <li><a href="https://ropensci.org/about#team">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate">Donate</a></li>
                            <li><a href="https://ropensci.org/contact">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/">Documentation</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                        <a href="http://numfocus.org" target="_blank"></a>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '799829e946e1f0f9cd5b5a782c6316b9',
    indexName: 'ropensci-nbar',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
